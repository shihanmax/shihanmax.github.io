<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>åºåˆ—æ ‡æ³¨å®è·µ - Shihanmax</title>
    <meta name="description" content="åºåˆ—æ ‡æ³¨é—®é¢˜æ˜¯ä¸€ç±»å…¸å‹çš„NLPé—®é¢˜ï¼Œå…·ä½“åº”ç”¨æœ‰ï¼šåˆ†è¯ã€è¯æ€§æ ‡æ³¨ã€å‘½åå®ä½“è¯†åˆ«ç­‰ã€‚">

    <link href="//fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin-ext,vietnamese"rel="stylesheet">
    <link rel="stylesheet" href="//css/main.css">
    <link rel="canonical" href="http://localhost:4000//2020/05/%E5%BA%8F%E5%88%97%E6%A0%87%E6%B3%A8%E5%AE%9E%E8%B7%B5">
    <link rel="alternate" type="application/rss+xml" title="Shihanmax" href="http://localhost:4000//feed.xml">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
    

    

</head>

    <body>
        <main class="u-container">
        <div class="c-page">
		<article class="c-article">
   	 	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [['$','$']]
      }
    });
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>

<header class="c-page__header">
        <h1><span class="half_background">Shihanmax's blog</span> ğŸš€</h1>
	
    <p>
        <a href="//">&lt; Back</a>
    </p>
	
</header>

    	<div class="c-article__main">
        <article class="c-article">
    <header class="c-article__header">
        <h1 class="c-article__title">åºåˆ—æ ‡æ³¨å®è·µ</h1>
        <p class="c-article__time"><time datetime="2020-05-11T01:16:03+08:00" itemprop="datePublished">May 11, 2020</time></p>
    </header>
    <div class="c-article__main">
        <p>åºåˆ—æ ‡æ³¨é—®é¢˜æ˜¯ä¸€ç±»å…¸å‹çš„NLPé—®é¢˜ï¼Œå…·ä½“åº”ç”¨æœ‰ï¼šåˆ†è¯ã€è¯æ€§æ ‡æ³¨ã€å‘½åå®ä½“è¯†åˆ«ç­‰ã€‚</p>

<p>åºåˆ—æ ‡æ³¨é—®é¢˜çš„å®šä¹‰æ˜¯ï¼šç»™å®šåºåˆ—$S$ï¼ŒæœŸæœ›é€šè¿‡æ¨¡å‹Må¾—åˆ°åºåˆ—ä¸­æ¯ä¸€ä¸ªtokenå¯¹åº”çš„æ ‡ç­¾åºåˆ—$Z$ï¼Œè¿™é‡Œå®šä¹‰ï¼Œ$S$ä¸­æ¯ä¸ªè¯tokençš„å¯èƒ½æƒ…å†µæœ‰$n_{word}$ä¸­ï¼Œæ ‡ç­¾åºåˆ—$Z$ä¸­çš„æ¯ä¸€ä¸ªæ ‡ç­¾tagçš„å¯èƒ½æƒ…å†µæœ‰$n_{tag}$ç§ã€‚</p>

<p>æœ¬æ–‡ä»å™ªå£°ä¿¡é“æ¨¡å‹çš„è§’åº¦å¯¹åºåˆ—æ ‡æ³¨é—®é¢˜è¿›è¡Œå»ºæ¨¡ï¼Œå¹¶é€šè¿‡ç»´ç‰¹æ¯”ç®—æ³•ä¼˜åŒ–æœ€ä¼˜è·¯å¾„çš„æœç´¢ã€‚</p>

<!--more-->

<p>å®šä¹‰ï¼š$S=w_1w_2w_3â€¦w_{N}$ï¼Œå¯¹åº”çš„ä»»ä¸€ç§æ ‡ç­¾åºåˆ—ä¸º$Z=z_1z_2z_3â€¦z_{N}$ï¼Œç›®æ ‡æ˜¯å¯»æ‰¾æœ€ä¼˜çš„æ ‡ç­¾åºåˆ—$\hat{Z}$ã€‚</p>

\[\begin{equation}\begin{aligned}  \hat{Z}&amp;=\mathop{argmax}_\limits{z}(P(Z\vert S)) \\&amp;=\mathop{argmax}_\limits{z}(P(S\vert Z)\cdot P(Z)) \\&amp;=\mathop{argmax}_\limits{z}(P(w_1w_2...w_N\vert z_1z_2...z_N) \cdot  P(z_1z_2...z_N))   \end{aligned}  \end{equation}\]

<p>ä¸Šå¼ä¸­ä¹˜ç§¯çš„ç¬¬ä¸€é¡¹ä¸ºTranslation modelï¼ˆTMï¼‰ã€ç¬¬äºŒé¡¹ä¸ºLanguage modelï¼ˆLMï¼‰ã€‚</p>

<p>åœ¨TMä¸­å¼•å…¥ç‹¬ç«‹å‡è®¾ï¼Œåœ¨LMä¸­å¼•å…¥bi-gramå‡è®¾ï¼Œå¯å¾—ï¼š</p>

\[\hat{Z}=\mathop{argmax}_\limits{z}( \prod_\limits{i=1}^{N}P(w_i\vert z_i)\cdot P(z_1)\cdot \prod_\limits{j=2}^N P(z_j\vert z_{j-1}))\]

<p>å¯¹æ¦‚ç‡è¿›è¡Œå¯¹æ•°åŒ–ï¼š</p>

\[\hat{Z}=\mathop{argmax}_\limits{z}( \sum_\limits{i=1}^{N} logP(w_i\vert z_i)+ log P(z_1)+ \sum_\limits{j=2}^N logP(z_j\vert z_{j-1}))\]

<p>ç›¸åŠ çš„ä¸‰é¡¹ä¸­ï¼Œç¬¬ä¸€é¡¹ä¸ºç”±æ ‡ç­¾åˆ°è¯çš„æ¡ä»¶æ¦‚ç‡ï¼Œè®°ä¸º$A$ï¼›ç¬¬äºŒé¡¹ä¸ºæ ‡ç­¾å‡ºç°åœ¨å¥é¦–çš„æ¦‚ç‡ï¼Œè®°ä¸º$B$ï¼Œç¬¬ä¸‰é¡¹ä¸ºæ ‡ç­¾ä¹‹é—´çš„è½¬ç§»æ¦‚ç‡ï¼Œè®°ä¸º$\pi$ã€‚</p>

<p>åœ¨æœ‰æ ‡æ³¨çš„æ•°æ®é›†ä¸Šï¼Œä¸Šè¿°ä¸‰é¡¹çš„æ¦‚ç‡èƒ½å¤Ÿé€šè¿‡ç»Ÿè®¡å¾—åˆ°ã€‚</p>

<p>å¯¹äºä¸€æ¡å¾…æ ‡æ³¨çš„æ–‡æœ¬$S_u$ï¼Œé•¿åº¦ä¸º$N$ï¼Œå…¶æ‰€æœ‰å¯èƒ½çš„æ ‡ç­¾åºåˆ—æœ‰$n_{tag}^N$ç§ï¼Œå¯¹æ‰€æœ‰æƒ…å†µå¯ä»¥è®¡ç®—æ¦‚ç‡$P(Z_i\vert S)$ï¼Œå–æ¦‚ç‡æœ€å¤§çš„æ ‡ç­¾åºåˆ—å³å¯ã€‚</p>

<p>å®é™…åº”ç”¨ä¸­ï¼Œæšä¸¾æ‰€æœ‰ç§å¯èƒ½çš„æ•ˆç‡æ˜¯éå¸¸ä½çš„ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨æ›´é«˜æ•ˆçš„ç®—æ³•æ¥å¯¹è·¯å¾„è¿›è¡Œå‰ªæã€‚ç»´ç‰¹æ¯”ç®—æ³•æ˜¯ä¸€ç§åŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œç”¨äºå¤šä¸ªæ­¥éª¤ä¸”æ¯ä¸ªæ­¥éª¤ä¸­æœ‰å¤šç§é€‰æ‹©çš„é—®é¢˜çš„æœ€ä¼˜è·¯å¾„é€‰æ‹©ã€‚ç»´ç‰¹æ¯”ç®—æ³•é€šè¿‡è®¡ç®—æ‰€æœ‰å‰åºæ­¥éª¤åˆ°å½“å‰æ­¥éª¤çš„æœ€å°ä»£ä»·ï¼ˆæˆ–æœ€å¤§æ”¶ç›Šï¼‰ï¼Œä»¥åŠå½“å‰æ­¥éª¤åšé€‰æ‹©æ—¶çš„ä»£ä»·ï¼ˆæ”¶ç›Šï¼‰æ¥è¿›è¡Œæ­¥éª¤çš„é€‰æ‹©ï¼Œæœ€åï¼Œé€šè¿‡å›æº¯æ³•æ¥é€‰æ‹©æœ€ä¼˜è·¯å¾„ã€‚</p>

<p>ä¸‹é¢æ˜¯ä¸Šè¿°è¿‡ç¨‹åœ¨è¯æ€§æ ‡æ³¨ä»»åŠ¡ä¸Šçš„ä¸€ç§å®ç°ã€‚</p>

<p>è®­ç»ƒæ•°æ®çš„æ ¼å¼ä¸ºï¼šæ¯è¡Œï¼šè¯/è¯æ€§</p>

<p>å®ç°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>


<span class="k">def</span> <span class="nf">build_mapper</span><span class="p">(</span><span class="n">train_data</span><span class="p">):</span>
    <span class="s">""" build token mapper and tag mapper """</span>
    <span class="n">tag2id</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">id2tag</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">word2id</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">id2word</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">word_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">tag_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span> <span class="k">as</span> <span class="n">fr</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fr</span><span class="p">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">sp_line</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp_line</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="n">sp_line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">word</span> <span class="o">=</span> <span class="s">"/"</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">sp_line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">word</span> <span class="o">=</span> <span class="n">sp_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="n">sp_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">word2id</span><span class="p">:</span>
                <span class="n">word2id</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">word_count</span>
                <span class="n">id2word</span><span class="p">[</span><span class="n">word_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">word</span>

                <span class="n">word_count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tag2id</span><span class="p">:</span>
                <span class="n">tag2id</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag_count</span>
                <span class="n">id2tag</span><span class="p">[</span><span class="n">tag_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag</span>

                <span class="n">tag_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">n_word</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word2id</span><span class="p">)</span>
    <span class="n">n_tag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag2id</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"word size:{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">n_word</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"tag size:{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">n_tag</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">word2id</span><span class="p">,</span> <span class="n">id2word</span><span class="p">,</span> <span class="n">tag2id</span><span class="p">,</span> <span class="n">id2tag</span><span class="p">,</span> <span class="n">n_word</span><span class="p">,</span> <span class="n">n_tag</span>


<span class="k">def</span> <span class="nf">build_params</span><span class="p">(</span><span class="n">word2id</span><span class="p">,</span> <span class="n">tag2id</span><span class="p">,</span> <span class="n">n_tag</span><span class="p">,</span> <span class="n">n_word</span><span class="p">,</span> <span class="n">train_data</span><span class="p">):</span>
    <span class="s">"""
    build params of HMM: theta = (pi, A, B)
    - pi is a vector marks the probe of each tag to be the first tag
      of a sentence, size: [1, n_tag]
    - A is a matrix of condition probe of words given tags,size: [n_tag, n_word]
    - B is a matrix of transition probe between tags, size: [n_tag, n_tag]"""</span>

    <span class="n">pi</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_tag</span><span class="p">)</span>  <span class="c1"># probe of starting tag
</span>    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_tag</span><span class="p">,</span> <span class="n">n_word</span><span class="p">))</span>  <span class="c1"># condition probe p(word|tag)
</span>    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_tag</span><span class="p">,</span> <span class="n">n_tag</span><span class="p">))</span>  <span class="c1"># transition probe p(tag_i|tag_j)
</span>
    <span class="n">at_start_of_sentence</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">last_tag_id</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span> <span class="k">as</span> <span class="n">fr</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fr</span><span class="p">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">word</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
            <span class="n">word_id</span> <span class="o">=</span> <span class="n">word2id</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
            <span class="n">tag_id</span> <span class="o">=</span> <span class="n">tag2id</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">at_start_of_sentence</span><span class="p">:</span>
                <span class="n">pi</span><span class="p">[</span><span class="n">tag_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># starting prob
</span>                <span class="n">a</span><span class="p">[</span><span class="n">tag_id</span><span class="p">,</span> <span class="n">word_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># cond. prob
</span>                <span class="n">at_start_of_sentence</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="p">[</span><span class="n">tag_id</span><span class="p">,</span> <span class="n">word_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># cond. prob
</span>                <span class="n">b</span><span class="p">[</span><span class="n">last_tag_id</span><span class="p">,</span> <span class="n">tag_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># trans. probe
</span>
            <span class="k">if</span> <span class="n">word</span> <span class="o">==</span> <span class="s">"."</span><span class="p">:</span>
                <span class="n">at_start_of_sentence</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">last_tag_id</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last_tag_id</span> <span class="o">=</span> <span class="n">tag_id</span>

    <span class="c1"># done counting, normalize...
</span>    <span class="n">pi</span> <span class="o">/=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_tag</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">pi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>


<span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">viterbi</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">word2id</span><span class="p">,</span> <span class="n">id2tag</span><span class="p">):</span>
    <span class="s">"""
    decode with viterbi
    :param sentence: sentence to decode
    :param pi: init probe of tag
    :param a: cond probe of words given tags
    :param b: trans probe between tags
    :return:
    """</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">word2id</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">.</span><span class="n">split</span><span class="p">()]</span>  <span class="c1"># words of sentence
</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">n_tag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag2id</span><span class="p">)</span>

    <span class="n">dp</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">n_tag</span><span class="p">))</span>
    <span class="n">path_record</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_tag</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_tag</span><span class="p">)])</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_tag</span><span class="p">):</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">pi</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

    <span class="c1"># dp
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>  <span class="c1"># æ¯ä¸ªå•è¯
</span>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_tag</span><span class="p">):</span>  <span class="c1"># æ¯ä¸ªè¯æ€§
</span>            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e6</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_tag</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">=</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                    <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
                    <span class="n">path_record</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>

    <span class="c1"># find best sequence
</span>    <span class="n">best_tag_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span>

    <span class="n">best_tag_sequence</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">best_tag_sequence</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_record</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">best_tag_sequence</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">tag_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">id2tag</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">best_tag_sequence</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">tag_sequence</span>


<span class="n">train_data_path</span> <span class="o">=</span> <span class="s">"./resource/traindata.txt"</span>
<span class="n">test_sentence</span> <span class="o">=</span> <span class="s">"The big question is whether the president will have the strength ."</span>

<span class="c1"># 1. build mapper of words and tags
</span><span class="n">word2id</span><span class="p">,</span> <span class="n">id2word</span><span class="p">,</span> <span class="n">tag2id</span><span class="p">,</span> <span class="n">id2tag</span><span class="p">,</span> <span class="n">n_word</span><span class="p">,</span> <span class="n">n_tag</span> <span class="o">=</span> <span class="n">build_mapper</span><span class="p">(</span><span class="n">train_data_path</span><span class="p">)</span>

<span class="c1"># 2. \theta = (\pi, A, B), build them
</span><span class="n">pi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">build_params</span><span class="p">(</span><span class="n">word2id</span><span class="p">,</span> <span class="n">tag2id</span><span class="p">,</span> <span class="n">n_tag</span><span class="p">,</span> <span class="n">n_word</span><span class="p">,</span> <span class="n">train_data_path</span><span class="p">)</span>

<span class="c1"># 3. find optimal path with viterbi
</span>
<span class="n">tag_sequence</span> <span class="o">=</span> <span class="n">viterbi</span><span class="p">(</span><span class="n">test_sentence</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">word2id</span><span class="p">,</span> <span class="n">id2tag</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">tag_sequence</span><span class="p">)</span>  <span class="c1"># ['DT', 'JJ', 'NN', 'VBZ', 'IN', 'DT', 'NN', 'MD', 'VB', 'DT', 'NN', '.']
</span></code></pre></div></div>


		

    </div>
    <footer class="c-article__footer">
        <p>
        
            <span class="c-tag">Sequence Labeling</span>
        
            <span class="c-tag">Machine Learning</span>
        
        </p>
    </footer>
</article>

		
			

		
    	</div>
    	<footer class="c-page__footer">
	<p>
    	
		<script type='text/javascript'>
			fortune = new Array(18);
			fortune[0] = 'è¿™åº§åŸå¸‚çš„ä¸­å¤®è®¡ç®—æœºå‘Šè¯‰ä½ çš„ï¼ŸR2D2ï¼Œä½ ä¸è¯¥ç›¸ä¿¡ä¸€å°é™Œç”Ÿçš„è®¡ç®—æœºï¼';
			fortune[1] = 'ä¸è¦ä¿¡èµ–é‚£äº›å¤§åˆ°ä¸èƒ½æ‰”å‡ºçª—å¤–çš„è®¡ç®—æœºï¼';
			fortune[2] = 'æˆ‘ç»ˆäºæ˜ç™½â€˜å‘ä¸Šå…¼å®¹æ€§â€™æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚è¿™æ˜¯æŒ‡æˆ‘ä»¬å¾—ä¿ç•™æ‰€æœ‰åŸæœ‰é”™è¯¯ã€‚';
			fortune[3] = '2038å¹´1æœˆ19æ—¥ï¼Œå‡Œæ™¨3ç‚¹14åˆ†07ç§’';
			fortune[4] = 'è®¡ç®—æœºå°±è·Ÿæ¯”åŸºå°¼ä¸€æ ·ï¼Œçœå»äº†äººä»¬è®¸å¤šçš„èƒ¡æ€ä¹±æƒ³ã€‚';
			fortune[5] = 'æˆ‘ä»¬æ˜¯å¾®è½¯ã€‚åæŠ—æ˜¯å¾’åŠ³çš„ã€‚ä½ ä¼šè¢«åŒåŒ–çš„ã€‚';
			fortune[6] = 'æ§åˆ¶å¤æ‚æ€§æ˜¯è®¡ç®—æœºç¼–ç¨‹çš„æœ¬è´¨ã€‚';
			fortune[7] = 'æœ‰ä¸ªè€å¥—çš„æ•…äº‹è¯´æœ‰äººå¸Œæœ›ä»–çš„è®¡ç®—æœºèƒ½åƒä»–çš„ç”µè¯æœºä¸€æ ·å¥½ç”¨ã€‚ä»–çš„æ„¿æœ›å®ç°äº†ï¼Œå› ä¸ºæˆ‘å·²ç»ä¸çŸ¥é“è¯¥å¦‚ä½•ä½¿ç”¨è‡ªå·±çš„ç”µè¯äº†ã€‚';
			fortune[8] = 'ä½ ä»¬å½“ä¸­å¾ˆå¤šäººéƒ½çŸ¥é“ç¨‹åºå‘˜çš„ç¾å¾·ã€‚å½“ç„¶å•¦ï¼Œæœ‰ä¸‰ç§ï¼šé‚£å°±æ˜¯æ‡’æƒ°ã€æ€¥èºä»¥åŠå‚²æ…¢ã€‚';
            fortune[9] = 'å°±ç®—å®ƒå·¥ä½œä¸æ­£å¸¸ä¹Ÿåˆ«æ‹…å¿ƒã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ æ—©è¯¥å¤±ä¸šäº†ã€‚'
            fortune[10] = 'å…ˆè§£å†³é—®é¢˜å†å†™ä»£ç ã€‚'
            fortune[11] = 'æˆ‘æƒ³å¾®è½¯ä¹‹æ‰€ä»¥æŠŠå®ƒå«åš.Netï¼Œæ˜¯å› ä¸ºè¿™æ ·å®ƒå°±ä¸ä¼šåœ¨Unixçš„ç›®å½•é‡Œæ˜¾ç¤ºå‡ºæ¥äº†ã€‚'
            fortune[12] = 'å¥½ä»£ç æœ¬èº«å°±æ˜¯æœ€å¥½çš„æ–‡æ¡£ã€‚'
            fortune[13] = 'å‰é¢90%çš„ä»£ç è¦å ç”¨å¼€å‘æ—¶é—´çš„å‰90%ã€‚å‰©ä¸‹çš„10%çš„ä»£ç è¦å ç”¨å¼€å‘æ—¶é—´çš„å¦ä¸€90%ã€‚'
            fortune[14] = 'æˆ‘è®¤ä¸ºå…¨çƒå¸‚åœºçº¦éœ€5å°è®¡ç®—æœºã€‚'
            fortune[15] = 'é•¿æ­¤ä»¥å¾€ï¼Œé™¤äº†æŒ‰é”®çš„æ‰‹æŒ‡å¤–ï¼Œäººç±»çš„è‚¢ä½“å°†å…¨éƒ¨é€€åŒ–ã€‚'
            fortune[16] = 'Thatâ€™s whatâ€™s cool about working with computers.  They donâ€™t argue, they remember everything, and they donâ€™t drink all your beer.'
            fortune[17] = 'The function of good software is to make the complex appear to be simple.'
			index = Math.floor(Math.random() * fortune.length);
			document.write(fortune[index]);
		</script>
	

    </p>
	
	<hr><br/>
	
    <br/>
	<p>&copy; Shihanmax 2021 | Super powered by Jekyll </p>
	
	<br/>
	
	<!--p>Follow me on: <a href="https://twitter.com/YourTwitterNo">Twitter</a> & <a href="https://github.com/YourGitHubNo">Github</a><span class="u-separate"></span> Subscribe: <a href="//feed.xml">RSS</a></p>
        
</footer>

</article>

        </main>
    </body>
</html>
