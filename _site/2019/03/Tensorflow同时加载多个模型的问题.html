<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ä½¿ç”¨TensotflowåŒæ—¶åŠ è½½å¤šä¸ªæ¨¡å‹ - Shihanmax</title>
    <meta name="description" content="ä½¿ç”¨å•ä¸ªæ¨¡å‹æ—¶ï¼Œä¸€ç§æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½çš„æ–¹å¼å¦‚ä¸‹ï¼š">

    <link href="//fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin-ext,vietnamese"rel="stylesheet">
    <link rel="stylesheet" href="//css/main.css">
    <link rel="canonical" href="http://localhost:4000//2019/03/Tensorflow%E5%90%8C%E6%97%B6%E5%8A%A0%E8%BD%BD%E5%A4%9A%E4%B8%AA%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%97%AE%E9%A2%98">
    <link rel="alternate" type="application/rss+xml" title="Shihanmax" href="http://localhost:4000//feed.xml">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
    

    

</head>

    <body>
        <main class="u-container">
        <div class="c-page">
		<article class="c-article">
   	 	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [['$','$']]
      }
    });
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>

<header class="c-page__header">
        <h1><span class="half_background">Shihanmax's blog</span> ğŸš€</h1>
	
    <p>
        <a href="//">&lt; Back</a>
    </p>
	
</header>

    	<div class="c-article__main">
        <article class="c-article">
    <header class="c-article__header">
        <h1 class="c-article__title">ä½¿ç”¨TensotflowåŒæ—¶åŠ è½½å¤šä¸ªæ¨¡å‹</h1>
        <p class="c-article__time"><time datetime="2019-03-19T01:38:00+08:00" itemprop="datePublished">Mar 19, 2019</time></p>
    </header>
    <div class="c-article__main">
        <p>ä½¿ç”¨å•ä¸ªæ¨¡å‹æ—¶ï¼Œä¸€ç§æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># è¾“å…¥/è¾“å‡ºå®šä¹‰
</span><span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="c1"># æƒé‡å®šä¹‰
</span><span class="n">weight</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>

<span class="c1"># opå®šä¹‰
</span><span class="n">output</span> <span class="o">=</span> <span class="n">some_operation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">calc_loss</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">train_op</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">Saver</span><span class="p">()</span>
    
    <span class="c1"># do some train è®­ç»ƒ
</span>    
    <span class="n">saver</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s">"./model/model_path"</span><span class="p">)</span>  <span class="c1"># ä¿å­˜æ¨¡å‹
</span></code></pre></div></div>
<!--more-->

<p>é’ˆå¯¹ä¸Šè¿°æ¨¡å‹ï¼Œæ¢å¤çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">Saver</span><span class="p">()</span>

    <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">():</span>
    <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    <span class="n">saver</span><span class="p">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s">"./model/model_path"</span><span class="p">)</span>  <span class="c1"># å°†æ¨¡å‹æ¢å¤åˆ°sessä¸­
</span>        
    <span class="n">output</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">output</span><span class="p">],</span> <span class="n">feed_dict</span><span class="o">=</span><span class="n">feed_dict</span><span class="p">)</span>  <span class="c1"># ä½¿ç”¨æ¢å¤çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹
</span></code></pre></div></div>

<p>å¯¹å•ä¸ªæ¨¡å‹æ¥è¯´ï¼Œè¿™ä¹ˆåšæ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚æœæˆ‘ä»¬è®­ç»ƒäº†å¤šä¸ªç›¸åŒç»“æ„çš„æ¨¡å‹ï¼Œæˆ‘ä»¬æœŸå¾…ä»¥å¦‚ä¸‹æ–¹å¼æ¢å¤å®ƒä»¬ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">all_sessions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_nums</span><span class="p">):</span>
	<span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">Saver</span><span class="p">()</span>

	<span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">():</span>
	<span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
	<span class="n">saver</span><span class="p">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s">"./model/model_path"</span><span class="p">)</span>  <span class="c1"># å°†æ¨¡å‹æ¢å¤åˆ°sessä¸­
</span>
	<span class="n">all_sessions</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">sess</span><span class="p">)</span>
</code></pre></div></div>
<p>ä½¿ç”¨ä¸Šè¿°æ¢å¤çš„sessionè¿›è¡Œé¢„æµ‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">all_result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">sess</span> <span class="ow">in</span> <span class="n">all_sessions</span><span class="p">:</span>
	<span class="n">all_result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">output</span><span class="p">],</span> <span class="n">feed_dict</span><span class="o">=</span><span class="n">feed_dict</span><span class="p">))</span>
</code></pre></div></div>
<p>ä½†è¿™ä¹ˆåšä¼šå¯¼è‡´å‚æ•°é”™è¯¯ï¼Œé¢„æµ‹ç»“æœå¼‚å¸¸ï¼ŒåŸå› æ˜¯å¤šä¸ªæ¨¡å‹ä¸­çš„å˜é‡ä¼šå‘ç”Ÿå†²çªï¼ŒåŸå› æ˜¯å°†æ‰€æœ‰çš„æ¨¡å‹å˜é‡éƒ½åŠ è½½åˆ°åŒä¸€ä¸ªçº¿ç¨‹çš„é»˜è®¤å›¾ä¸­ï¼Œè§£å†³æ–¹æ³•æ˜¯ï¼Œé’ˆå¯¹ä¸åŒçš„modelä½¿ç”¨ä¸åŒçš„é»˜è®¤å›¾ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ImportGraph</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="n">as_default</span><span class="p">():</span>
            <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">import_meta_graph</span><span class="p">(</span><span class="s">"./model/model_path"</span> <span class="o">+</span> <span class="s">'.meta'</span><span class="p">)</span>
            <span class="n">saver</span><span class="p">.</span><span class="n">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sess</span><span class="p">,</span> <span class="s">"./model/model_path"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    	<span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">output</span><span class="p">],</span> <span class="n">feed_dict</span><span class="o">=</span><span class="n">feed_dict</span><span class="p">)</span>
</code></pre></div></div>
<p>ä¸Šè¿°æ–¹å¼æ˜¯ä»<a href="https://blog.csdn.net/lc013/article/details/84202901">åšå®¢</a>çœ‹åˆ°çš„ï¼Œåœ¨æˆ‘çš„å®éªŒä¸­ï¼Œå¹¶æœ‰æœ‰æˆåŠŸåœ°å°†å¤šä¸ªæ¨¡å‹æ¢å¤ï¼Œæˆ‘çš„æ¢å¤æ–¹å¼æ˜¯ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ImportGraph</span><span class="p">():</span>
	<span class="n">tf</span><span class="p">.</span><span class="n">reset_default_graph</span><span class="p">()</span>  <span class="c1"># The default graph is a property of the current thread. é‡ç½®å½“å‰çº¿ç¨‹ä¸­çš„é»˜è®¤å›¾
</span>	<span class="bp">self</span><span class="p">.</span><span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">Saver</span><span class="p">()</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">saver</span><span class="p">.</span><span class="n">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">sess</span><span class="p">,</span> <span class="s">"./model/model_path"</span><span class="p">)</span>
</code></pre></div></div>

<p>é‡è¦çš„åœ°æ–¹åœ¨äºtf.reset_default_graph()ï¼Œtfå®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tf.reset_default_graph()
Defined in tensorflow/python/framework/ops.py.

Clears the default graph stack and resets the global default graph.

NOTE: The default graph is a property of the current thread. This function applies only to the current thread. Calling this function while a tf.Session or tf.InteractiveSession is active will result in undefined behavior. Using any previously created tf.Operation or tf.Tensor objects after calling this function will result in undefined behavior.
</code></pre></div></div>

		

    </div>
    <footer class="c-article__footer">
        <p>
        
            <span class="c-tag">Deep Learning</span>
        
            <span class="c-tag">Tensorflow</span>
        
            <span class="c-tag">Machine Learning Library</span>
        
        </p>
    </footer>
</article>

		
			

		
    	</div>
    	<footer class="c-page__footer">
	<p>
    	
		<script type='text/javascript'>
			fortune = new Array(18);
			fortune[0] = 'è¿™åº§åŸå¸‚çš„ä¸­å¤®è®¡ç®—æœºå‘Šè¯‰ä½ çš„ï¼ŸR2D2ï¼Œä½ ä¸è¯¥ç›¸ä¿¡ä¸€å°é™Œç”Ÿçš„è®¡ç®—æœºï¼';
			fortune[1] = 'ä¸è¦ä¿¡èµ–é‚£äº›å¤§åˆ°ä¸èƒ½æ‰”å‡ºçª—å¤–çš„è®¡ç®—æœºï¼';
			fortune[2] = 'æˆ‘ç»ˆäºæ˜ç™½â€˜å‘ä¸Šå…¼å®¹æ€§â€™æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚è¿™æ˜¯æŒ‡æˆ‘ä»¬å¾—ä¿ç•™æ‰€æœ‰åŸæœ‰é”™è¯¯ã€‚';
			fortune[3] = '2038å¹´1æœˆ19æ—¥ï¼Œå‡Œæ™¨3ç‚¹14åˆ†07ç§’';
			fortune[4] = 'è®¡ç®—æœºå°±è·Ÿæ¯”åŸºå°¼ä¸€æ ·ï¼Œçœå»äº†äººä»¬è®¸å¤šçš„èƒ¡æ€ä¹±æƒ³ã€‚';
			fortune[5] = 'æˆ‘ä»¬æ˜¯å¾®è½¯ã€‚åæŠ—æ˜¯å¾’åŠ³çš„ã€‚ä½ ä¼šè¢«åŒåŒ–çš„ã€‚';
			fortune[6] = 'æ§åˆ¶å¤æ‚æ€§æ˜¯è®¡ç®—æœºç¼–ç¨‹çš„æœ¬è´¨ã€‚';
			fortune[7] = 'æœ‰ä¸ªè€å¥—çš„æ•…äº‹è¯´æœ‰äººå¸Œæœ›ä»–çš„è®¡ç®—æœºèƒ½åƒä»–çš„ç”µè¯æœºä¸€æ ·å¥½ç”¨ã€‚ä»–çš„æ„¿æœ›å®ç°äº†ï¼Œå› ä¸ºæˆ‘å·²ç»ä¸çŸ¥é“è¯¥å¦‚ä½•ä½¿ç”¨è‡ªå·±çš„ç”µè¯äº†ã€‚';
			fortune[8] = 'ä½ ä»¬å½“ä¸­å¾ˆå¤šäººéƒ½çŸ¥é“ç¨‹åºå‘˜çš„ç¾å¾·ã€‚å½“ç„¶å•¦ï¼Œæœ‰ä¸‰ç§ï¼šé‚£å°±æ˜¯æ‡’æƒ°ã€æ€¥èºä»¥åŠå‚²æ…¢ã€‚';
            fortune[9] = 'å°±ç®—å®ƒå·¥ä½œä¸æ­£å¸¸ä¹Ÿåˆ«æ‹…å¿ƒã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ æ—©è¯¥å¤±ä¸šäº†ã€‚'
            fortune[10] = 'å…ˆè§£å†³é—®é¢˜å†å†™ä»£ç ã€‚'
            fortune[11] = 'æˆ‘æƒ³å¾®è½¯ä¹‹æ‰€ä»¥æŠŠå®ƒå«åš.Netï¼Œæ˜¯å› ä¸ºè¿™æ ·å®ƒå°±ä¸ä¼šåœ¨Unixçš„ç›®å½•é‡Œæ˜¾ç¤ºå‡ºæ¥äº†ã€‚'
            fortune[12] = 'å¥½ä»£ç æœ¬èº«å°±æ˜¯æœ€å¥½çš„æ–‡æ¡£ã€‚'
            fortune[13] = 'å‰é¢90%çš„ä»£ç è¦å ç”¨å¼€å‘æ—¶é—´çš„å‰90%ã€‚å‰©ä¸‹çš„10%çš„ä»£ç è¦å ç”¨å¼€å‘æ—¶é—´çš„å¦ä¸€90%ã€‚'
            fortune[14] = 'æˆ‘è®¤ä¸ºå…¨çƒå¸‚åœºçº¦éœ€5å°è®¡ç®—æœºã€‚'
            fortune[15] = 'é•¿æ­¤ä»¥å¾€ï¼Œé™¤äº†æŒ‰é”®çš„æ‰‹æŒ‡å¤–ï¼Œäººç±»çš„è‚¢ä½“å°†å…¨éƒ¨é€€åŒ–ã€‚'
            fortune[16] = 'Thatâ€™s whatâ€™s cool about working with computers.  They donâ€™t argue, they remember everything, and they donâ€™t drink all your beer.'
            fortune[17] = 'The function of good software is to make the complex appear to be simple.'
			index = Math.floor(Math.random() * fortune.length);
			document.write(fortune[index]);
		</script>
	

    </p>
	
	<hr><br/>
	
    <br/>
	<p>&copy; Shihanmax 2021 | Super powered by Jekyll </p>
	
	<br/>
	
	<!--p>Follow me on: <a href="https://twitter.com/YourTwitterNo">Twitter</a> & <a href="https://github.com/YourGitHubNo">Github</a><span class="u-separate"></span> Subscribe: <a href="//feed.xml">RSS</a></p>
        
</footer>

</article>

        </main>
    </body>
</html>
